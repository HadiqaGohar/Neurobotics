# User Profile Management System\n\nThis document describes the user profile management system implemented as part of Phase 4 of the secure user authentication feature.\n\n## Overview\n\nThe profile management system provides comprehensive user profile functionality including:\n\n- User profile viewing and editing\n- Password management\n- User preferences and settings\n- Authentication state management\n- Data export/import capabilities\n- Profile validation and security checks\n\n## Components\n\n### Core Components\n\n#### UserProfile Component\n- **Location**: `src/auth/UserProfile.tsx`\n- **Purpose**: Main profile management interface\n- **Features**:\n  - Edit full name\n  - Change password with validation\n  - View account information\n  - Real-time validation\n  - Success/error feedback\n\n#### UserMenu Component\n- **Location**: `src/components/UserMenu/index.tsx`\n- **Purpose**: Navigation menu for authenticated users\n- **Features**:\n  - User avatar with initials\n  - Quick access to profile and settings\n  - Logout functionality\n  - Account status display\n  - Responsive design\n\n### Supporting Systems\n\n#### AuthStorage\n- **Location**: `src/auth/authStorage.ts`\n- **Purpose**: Persistent authentication state management\n- **Features**:\n  - Structured state storage\n  - Device ID generation\n  - Backup and recovery\n  - Data validation\n  - Storage statistics\n\n#### UserPreferencesManager\n- **Location**: `src/auth/userPreferences.ts`\n- **Purpose**: User preferences management\n- **Features**:\n  - Theme management (light/dark/auto)\n  - Language preferences\n  - Notification settings\n  - Privacy controls\n  - Export/import functionality\n\n#### AuthStateManager\n- **Location**: `src/auth/authStateManager.ts`\n- **Purpose**: Comprehensive authentication state tracking\n- **Features**:\n  - State snapshots\n  - History tracking\n  - State validation\n  - Statistics and analytics\n  - Complete data management\n\n## API Integration\n\n### Backend Endpoints\n\nThe profile system integrates with the following backend endpoints:\n\n- `GET /api/auth/me` - Get current user profile\n- `PUT /api/auth/me` - Update user profile\n- `POST /api/auth/logout` - User logout\n- `POST /api/auth/refresh` - Token refresh\n\n### Request/Response Format\n\n#### Get Profile Response\n```json\n{\n  \"id\": \"user-id\",\n  \"email\": \"user@example.com\",\n  \"full_name\": \"User Name\",\n  \"is_active\": true,\n  \"created_at\": \"2023-01-01T00:00:00Z\",\n  \"last_login\": \"2023-12-07T10:00:00Z\"\n}\n```\n\n#### Update Profile Request\n```json\n{\n  \"full_name\": \"Updated Name\",\n  \"current_password\": \"current_password\",\n  \"new_password\": \"new_password\"\n}\n```\n\n## Pages and Routes\n\n### Profile Page\n- **Route**: `/auth/profile`\n- **Component**: `src/pages/auth/profile.tsx`\n- **Features**: Basic profile management with debug component\n\n### Settings Page\n- **Route**: `/auth/settings`\n- **Component**: `src/pages/auth/settings.tsx`\n- **Features**: \n  - Tabbed interface\n  - Profile management\n  - User preferences\n  - Security settings\n  - Data management\n\n## Hooks and Utilities\n\n### useUserProfile Hook\n- **Location**: `src/auth/authHooks.ts`\n- **Purpose**: Profile management state and operations\n- **Returns**:\n  - `user`: Current user data\n  - `isUpdating`: Update loading state\n  - `updateError`: Update error message\n  - `updateUserProfile()`: Update function\n  - `clearUpdateError()`: Error clearing function\n\n### useUserPreferences Hook\n- **Location**: `src/auth/userPreferences.ts`\n- **Purpose**: User preferences management\n- **Returns**:\n  - `preferences`: Current preferences\n  - `updatePreferences()`: Update function\n  - `resetPreferences()`: Reset function\n  - `getPreference()`: Get single preference\n  - `setPreference()`: Set single preference\n\n### useAuthStateManager Hook\n- **Location**: `src/auth/authStateManager.ts`\n- **Purpose**: Authentication state management\n- **Returns**:\n  - `snapshot`: Current state snapshot\n  - `history`: State history\n  - `stats`: Authentication statistics\n  - `createSnapshot()`: Create snapshot function\n  - `exportState()`: Export function\n  - `importState()`: Import function\n  - `validateState()`: Validation function\n\n## Styling\n\n### CSS Files\n- `src/css/auth.css` - Main authentication styles including profile styles\n- `src/components/UserMenu/styles.css` - User menu specific styles\n\n### Style Classes\n- `.user-profile` - Main profile container\n- `.profile-form` - Profile form styling\n- `.profile-button` - Profile action buttons\n- `.user-menu-container` - User menu container\n- `.user-menu-dropdown` - Dropdown menu styling\n\n## Security Features\n\n### Password Management\n- Current password verification required\n- Password strength validation\n- Secure password hashing (handled by backend)\n- Password change confirmation\n\n### Session Management\n- Automatic token refresh\n- Session timeout handling\n- Activity tracking\n- Secure logout\n\n### Data Protection\n- Input validation and sanitization\n- XSS protection\n- CSRF protection (via tokens)\n- Secure storage practices\n\n## Usage Examples\n\n### Basic Profile Update\n```tsx\nimport { useUserProfile } from '../auth/authHooks';\n\nconst MyComponent = () => {\n  const { updateUserProfile, isUpdating } = useUserProfile();\n  \n  const handleUpdate = async () => {\n    try {\n      await updateUserProfile({\n        full_name: 'New Name'\n      });\n      console.log('Profile updated!');\n    } catch (error) {\n      console.error('Update failed:', error);\n    }\n  };\n  \n  return (\n    <button onClick={handleUpdate} disabled={isUpdating}>\n      {isUpdating ? 'Updating...' : 'Update Profile'}\n    </button>\n  );\n};\n```\n\n### Preferences Management\n```tsx\nimport { useUserPreferences } from '../auth/userPreferences';\n\nconst PreferencesComponent = () => {\n  const { preferences, updatePreferences } = useUserPreferences();\n  \n  const handleThemeChange = (theme) => {\n    updatePreferences({ theme });\n  };\n  \n  return (\n    <select \n      value={preferences.theme} \n      onChange={(e) => handleThemeChange(e.target.value)}\n    >\n      <option value=\"light\">Light</option>\n      <option value=\"dark\">Dark</option>\n      <option value=\"auto\">Auto</option>\n    </select>\n  );\n};\n```\n\n### State Management\n```tsx\nimport { useAuthStateManager } from '../auth/authStateManager';\n\nconst StateComponent = () => {\n  const { snapshot, exportState, validateState } = useAuthStateManager();\n  \n  const handleExport = () => {\n    const data = exportState();\n    // Handle export...\n  };\n  \n  const handleValidate = () => {\n    const result = validateState();\n    console.log('Validation result:', result);\n  };\n  \n  return (\n    <div>\n      <p>User: {snapshot?.user?.email}</p>\n      <button onClick={handleExport}>Export Data</button>\n      <button onClick={handleValidate}>Validate State</button>\n    </div>\n  );\n};\n```\n\n## Testing\n\n### ProfileTest Component\n- **Location**: `src/components/ProfileTest/index.tsx`\n- **Purpose**: Debug and test profile functionality\n- **Features**: Simple profile update testing\n\n### Manual Testing\n1. Navigate to `/auth/profile`\n2. Verify profile information displays correctly\n3. Test profile updates (name, password)\n4. Verify validation works\n5. Test error handling\n6. Check responsive design\n\n## Troubleshooting\n\n### Common Issues\n\n1. **Profile not loading**\n   - Check authentication status\n   - Verify API endpoints are accessible\n   - Check network connectivity\n\n2. **Update failures**\n   - Verify current password is correct\n   - Check validation requirements\n   - Review server error logs\n\n3. **Preferences not persisting**\n   - Check localStorage availability\n   - Verify AuthStorage functionality\n   - Clear browser cache if needed\n\n4. **Styling issues**\n   - Ensure CSS files are loaded\n   - Check for theme conflicts\n   - Verify responsive breakpoints\n\n### Debug Tools\n\n1. **useAuthDebug Hook**\n   ```tsx\n   import { useAuthDebug } from '../auth/authHooks';\n   \n   const debugInfo = useAuthDebug();\n   console.log('Auth Debug Info:', debugInfo);\n   ```\n\n2. **Browser DevTools**\n   - Check localStorage for auth data\n   - Monitor network requests\n   - Review console errors\n\n3. **State Validation**\n   ```tsx\n   const { validateState } = useAuthStateManager();\n   const validation = validateState();\n   console.log('State validation:', validation);\n   ```\n\n## Future Enhancements\n\n### Planned Features\n- Avatar upload functionality\n- Two-factor authentication\n- Account deletion/deactivation\n- Advanced privacy controls\n- Audit log viewing\n- Social login integration\n\n### Performance Optimizations\n- Lazy loading of profile components\n- Caching of user preferences\n- Optimistic updates\n- Background sync\n\n### Accessibility Improvements\n- Screen reader support\n- Keyboard navigation\n- High contrast mode\n- Focus management\n\n## Conclusion\n\nThe user profile management system provides a comprehensive solution for managing user accounts, preferences, and authentication state. It follows security best practices and provides a smooth user experience with proper error handling and validation.\n\nFor additional support or questions, refer to the authentication documentation or contact the development team."